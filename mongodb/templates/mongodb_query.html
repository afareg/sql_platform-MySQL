{% extends "include/base.html" %}
{% block title %}
    <title>MONGO_QUERY</title>
{% endblock %}
{% block name %}
    欢迎使用MongoDB查询功能
{% endblock %}
{%block content%}
    <table >
        <form role="form" method='post'>
            <tr>
                <td>
                    </br>
                    </br>

                    {% csrf_token %}
                    CHOOSE :
                    {#                {%  if choosed_table %}#}
                    {#                    <select class="form-control col-md-1" name = "tablename">#}
                    {#                        <option value ="{{ choosed_table }}">{{ choosed_table }}</option>#}
                    {#                    </select></br>#}
                    {#                    <a href="/mongo_query/"><input type="button" value="重选数据源" class="btn btn-danger"></a>#}
                    {#                {% else %}#}
                    {#                    <select class="form-control col-md-1" name = "tablename">#}
                    {#                        {% for obj in tablelist %}#}
                    {#                            <option value ="{{ obj }}">{{ obj }}</option>#}
                    {#                        {% endfor %}#}
                    {#                    </select>#}
                    {#                {% endif %}#}

                    {%  if choosedb %}
                        {#                                <select class="form-control col-md-1" name = "cx">#}
                        {#                                    <option value ="{{ choosed_host }}">{{ choosed_host }}</option>#}
                        {#                                </select></br>#}
                        <select class="form-control col-md-1" name = "choosedb">
                            {% for obj in dblist %}
                                {% if obj == choosedb %}
                                    <option selected="selected" value ="{{ obj }}">{{ obj }}</option>
                                {% else %}
                                    <option value ="{{ obj }}">{{ obj }}</option>
                                {% endif %}
                            {% endfor %}
                        </select></br>
                        <a href="/mongodb/query/"><input type="button" value="刷新" class="btn btn-danger"></a>
                    {% else %}
                        <select class="form-control col-md-1" name = "choosedb">
                            {% for obj in dblist %}
                                <option value ="{{ obj }}">{{ obj }}</option>
                            {% endfor %}
                        </select>
                    {% endif %}






                    </br>
                    <button type="submit" name='dbinfo' class="btn btn-success" value="1">库状态</button >

                    <button type="submit" name='gettblist' class="btn btn-primary" value="1">列出表</button >
                    </br>

                    {%  if tblist %}
                        <select class="form-control col-md-1" name = "choosed_tb">
                            {% for obj in tblist %}
                                {% if obj == choosed_tb %}
                                    <option selected="selected" value ="{{ obj }}">{{ obj }}</option>
                                {% else %}
                                    <option value ="{{ obj }}">{{ obj }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>

                        请在下面输入查询语句:</br>
                        {{ form.a }} </br> </br>
                        <button type="submit" name='query' class="btn btn-primary" value="1">提交查询</button >
                        <button type="submit" name='tbinfo' class="btn btn-danger" value="1">查看表状态</button >
                        <button type="submit" name='tbindexinfo' class="btn btn-success" value="1">查看表索引信息</button >


                    {% endif %}
                </td>
                {%  if tblist %}
                    <td>
                        <div class="col-md-12">
                            <h3>查询注意事项:</h3>
                            <p class="bg-danger"> 1. 仅支持单条语句查询 </p>
                            <p> 2. 平台默认查询限制是200行
                            <p> 3. 简单匹配:{'telephone': 13800111101}</p>
                            <p> 4. 区间查询:{'updateTime':{'$gt':1470281159895,'$lt':1470281159897}}</p>
                        </div>
                    </td>
                {% endif %}
            </tr>
        </form>




    </table>

    </br>
    {% if data_list %}
        </br>
        <table id="mytable" class="table table-condensed" border="1">
            <thead>
            <tr class="danger">
                <th>
                    Records
                </th>
            </tr>
            </thead>
            <tbody  >
            {% for item in data_list %}
                <tr>
                    <td> {{ item  }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}
    {% if info %}
        </br>
        <table class="table table-condensed" border="1">
            <tbody  >
            {% for k,v in info.items %}
                <tr>
                    <td> {{ k }}</td>
                    <td> {{ v }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    {% endif %}
    {% if  indinfo %}
        </br>
        <table class="table table-condensed" border="1">
            <tbody  >
            {% for k,v in indinfo.items %}
                {% for x,y in v.items %}
                    <tr>
                        <td>
                            {{ x }}
                        </td>
                        <td>

                            {{ y }}
                        </td>
                    <tr>
                {% endfor %}

            {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}
{% block script %}
    {% include "include/pagejump/tabledata.html" %}
{% endblock %}

